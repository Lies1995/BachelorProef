\section{Resultaten en Discussie} % (fold)
\label{sec:resultaten}
%TO DO
%lijn 25: fluence rate vervangen door lichtverdeling of tussen haakjes erbij zetten.
Simulaties voor de temperatuursverandering in weefsel met de tijdsconstanten methode worden uitgevoerd voor de hippocampus regio in het rat brein. Er wordt gefocusd op protocols voor golflengten $474nm$ en $560nm$ en voor zowel een single-mode ($d=0.009nm$, NA=$0.12$)als multi-mode ($d=0.300nm$, NA=$0.37$) optische vezel. Deze twee golflengte omdat een veel gebruikt opsin $ChR2$ optimaal werkt bij een golflengt $\approx 470nm$ en er een hoge piek is bij de absorptieco\"effici\"ent voor een golflengte vaan $560nm$. Dit is ideaal om de invloed van de absorptie op de temperatuursverandering na te gaan.  
\subsection{Energieverdeling} % (fold)
\label{sub:energieverdeling}
Het \emph{Monte-Carlo multi layer} programma geeft $\psi(r,z)$, de lichtverdeling corresponderend met een eenheid irradiantie $I=1\frac{W}{m^2}$. Om vervolgens de eigenlijke lichtverdeling $\phi(r,z)$ voor een bepaald stimulatie protocol te bekomen wordt vergelijking \ref{} gebruikt. Figuur \ref{fig:FR} geeft $\phi(r,z)$ weer voor een stimulatie van laserlicht met een power van $1mW$ en voor de vier verschillende protocols waarop gefocusd wordt in dit onderzoek. 
De contourlijn op $1\frac{mW}{mm^2}$ geeft het maximale oppervlak aan waarin opsin stimulatie kan optreden, zie paragraaf \ref{sub:interactie_van_weefsel_met_elektromagnetische_straling}.  
%\onecolumn
%\begin{wrapfigure}{r}{0.01\textwidth}
%\begin{minipage}{\textwidth}
\begin{figure*}[!ht]%#TODO; eenheden +andere schaling
  	\centering
  	\includegraphics[width=\textwidth]{gfx/FR_P1mW.png}
  	\caption{Lichtverdeling voor een vermogen van $1mW$ voor de 4 verschillende protocols. De volle contourlijn ligt op $1\frac{mW}{mm^2}$. De stippelijn en streepjeslijn tonen dezelfde contour, maar dan voor $\phi \pm \sigma$ (zie paragraaf \ref{subsec:fout}). }
  	\label{fig:FR}
  \end{figure*}
%\end{minipage} 
 % \end{wrapfigure} 
  %\twocolumn
Er zijn een aantal dingen die onmiddellijk opvallen bij de vergelijking van de energieverdeling voor de verschillende protocols. Wanneer de twee golflengten vergeleken worden valt op dat voor $474nm$ de energie meer radiaal verspreidt wordt, terwijl bij de $560nm$ vooral in de axiale riching verdeeld wordt. Een hoge absorptie zorgt dus voor minder verspreiding in de radiale richting en meer in axiale richting. 

De energieverdelingen voor de verschillende optische vezels (NA=$0.12$ en NA=$0.37$) verschillen vooral wat betreft de energieverspreiding. Bij een single-mode (NA=$0.12$) is de meeste energie geconcentreerd rond de oorsprong, terwijl bij de multi-mode een meer homogene verdeling van de energie plaatsvindt. Dit is wat te verwachten was. Een kleine NA betekent een kleine verspreidingshoek waaronder het laserlicht aangevoerd wordt naar het weefsel. Alle energie wordt op een kleine plek geconcentreerd en dus het grootste deel van de energie wordt op dezelfde plek geabsorbeerd. Wanneer de energie echter vanaf het begin meer gespreid wordt aangevoerd (multi-mode) zal deze zich meer evenredig verspreiden over het oppervlak. De maximale energieconcentratie bij de SM is dus een factor $10^2$ groter. 

Er is een poging ondernomen om de resolutie van de afbeeldingen van $\phi(r,z)$ te verbeteren. Vooral bij de simulaties voor de SM zou dit nuttig zijn. Als invoer in het MCML-programma moet je naast de thermische en weefsel eigenschappen ook het aantal afgevuurde fotonen en het gebied specifici\"eren. Het gebied waarin de fotonen mogen wandelen is een rooster met allemaal roosterpunten. Het aantal moet dus gespecifici\"eerd worden en de roosterafstand. 
Een eerste mogelijkheid is het verhogen van het aantal afgevuurde fotonen. Dit vraagt echter veel rekenvermogen, dus gepast technologisch materiaal is hiervoor vereist.
Een tweede mogelijkheid is een zelfde aantal fotonen afvuren maar het gebied verkleinen, dus de roosterafstand verkleinen. Echter moet opgepast worden dat het gebied niet te klein is, de fotonen mogen niet in de buurt van de rand komen omdat daar geen rekening mee is gehouden in de code. Dit is een aantal keer geprobeerd maar er trad elke een probleem op met de schaling. Het gebied in een richting (axiaal of radiaal) is gelijk aan het aantal roosterpunten vermenigvuldigd met de roosterafstand. De eersta schaling was $1000$ roosterpunten in de axiale richting en $500$ in de radiale. De roosterafstand was twee keer $10^-4 cm$. De afmetingen van het gebied waarin de lichtverdeling gesimuleerd moet worden is: $0.1cm$ x $0.05cm$. Echter krijgen we uit de data van het programma afmetingen van $1cm$ x $O.5cm$. Wanneer nu de rooster afstand gehalveerd word, waren de afmetingen wel wat verwacht was, namelijk $0.5cm$ x $0.25cm$. Het eigenaardige is vooral dat er twee keer exact dezelfde code wordt gebruikt, zowel het MCML simulatie programma als de matlab code die de data-files inleest, omzet en grafisch weergeeft. Dit is een probleem waar niet onmiddellijk een oplosing voor gevonden kon worden omdat de code voor het MCML programma niet beschikbaar is. De simulaties zijn verschillende keren herhaald met steed hetzelfde eigenaardige resultaat. Echter wordt niet uitgesloten dat het eventueel toch ergens een menselijke fout is in de inleescode. Indien betere resolutie van de lichtverdeling noodzakelijk is dit iets wat de moeite waard is om na te kijken. 
Verder is er ook een typfout bij de eenheden in de resulterende data file gevonden. Bij het omzetten van de fotonendistributie naar een fysische grootheid zijn er verschillende mogelijkheden. 
\begin{itemize}
	\item .Frzc, Fluence rate [$W\cdot cm^-2$]
	\item .Arz, Absorptie [$W\cdot cm^-3$]
	\item \ldots
\end{itemize}
De extensie die hier nodig is, is de .Frzc en in deze datafile staat als eenheid bij de lichtverdeling [$W\cdot cm^-3$]. Aangezien een andere extensie deze eenheid al heeft, is dit een verwarrende fout die uit de code gehaald moet worden. 

\subsection{Temperatuurstijging bij continue stimulatie}
De resultaten voor de lichtverdeling bekomen met de Monte-Carlo simulatie werden gebruikt om de temperatuurstijging voor continue stimulatie te bepalen. Dit werd gedaan voor alle vier de protocols, telkens bij een vermogen van $1mW$. Er kunnen nu verschillende figuren gemaakt worden.
\\
Als eerste werden er kleurenplots gemaakt die de tijdsevolutie van de temperatuursverandering weergeven. De resultaten voor \'{e}\'{e}n van de protocols, namelijk $\lambda = 560nm$ en multi-mode, staan afgebeeld in figuur \ref{fig:dT_560_MM}, die voor de andere protocols kan men vinden in de bijlage (figuur \ref{fig:dT_Overig_Bijlage}). De temperatuurstijging werd telkens geplot op drie verschillende tijdstippen. Een eerste tijdstip werd gekozen vlak nadat het laserlicht op het weefsel begint te schijnen, in dit geval $t=0.001s$. Als tweede tijdstip werd telkens $t=\tau $ gekozen en als laatste tijdstip werd $t=3\tau$, dit tijdstip is de uiterste grens waarop ons model geldig is. Op dit laatste tijdstip is de temperatuur reeds gesatureerd, zodat de rechtse afbeelding telkens de finale temperatuurstijging weergeeft. Op deze afbeeldingen is duidelijk de evolutie van de temperatuursverandering zichtbaar. In het begin is de maximale temperatuurstijging lager en is de verandering minder verspreidt. Naarmate de tijd vordert wordt de maximale temperatuur groter en verspreidt de temperatuurstijging zich verder doorheen het weefsel. De fouten op deze figuren werden wel berekend, maar niet afgebeeldt omdat dat de figuren te ingewikkeld zou maken.  
% figuur
% label{fig:dT_560_MM}
\begin{figure*}[!ht]
  	\centering
  	\includegraphics[width=\textwidth]{gfx/dT_560_MM.png}
  	\caption{Temperatuurstijging voor continue stimulatie bij $\lambda =560nm$ en MM op 3 verschillende tijdstippen.}
  	\label{fig:dT_560_MM}
  \end{figure*} 
\\
Op figuren \ref{fig:dT_tijd_SM}  en \ref{fig:dT_tijd_MM} werd de temperatuurstijging van het hersenweefsel geplot in functie van de tijd op $z=0$ en $r=0$, telkens voor de twee verschillende golflengtes. Op de grafieken werd telkens $t=\tau$ aangeduid met een stippellijn. Aangezien de tijdsconstante voor eenzelfde vezel (SM of MM) zeer weinig van elkaar verschillen (zie later) kon er per afbeelding \'e\'en stippellijn getekend worden. Wanneer men naar de vorm van de grafieken kijkt, is te zien dat de temperatuurstijging inderdaad vrij snel zal satureren. Anderzijds is het opvallend dat de temperatuurstijging voor $560nm$ veel groter is dan voor $474nm$. Dit komt omdat de absorptie co\"effici\"ent van het weefsel een piek vertoont rond $550nm$. Rond $550nm$ zal de absorptie van fotonen door het weefsel veel groter zijn omwille van absorptie door hemoglobine. \cite{ ThermEff } Hierdoor zal de absorptie co\"ffici\"ent bij $560nm$ groter zijn dan bij $474nm$ en aangezien absorptie verantwoordelijk is voor temperatuurstijging, verklaart dit de grotere temperatuursverandering bij $560nm$.
%figuur
% label{fig:dT_tijd_SM}
%label{fig:dT_tijd_MM}
\begin{figure}[h!]
  	\centering

  	\includegraphics[width=8.5cm]{gfx/dT_tijd_SM.png}
  	\caption{Temperatuurstijging met fouten op $z=0$ en $r=0$ voor SM.}

  	\label{fig:dT_tijd_SM}
  \end{figure} 
	
	\begin{figure}[h!]
  	\centering
  	\includegraphics[width=8.5cm]{gfx/dT_tijd_MM.png}
  	\caption{Temperatuurstijging met fouten op $z=0$ en $r=0$ voor MM.}
  	\label{fig:dT_tijd_MM}
  \end{figure} 
\\

Zoals daarnet al werd vermeld, is er een zeer klein verschil tussen de tijdsconstanten voor eenzelfde vezel. Dit kan men zien in tabel \ref{tab:tau}. Voor verschillende golflengten is $\tau$ min of meer gelijk. De rede hiervoor is dat de waarde van de optische parameters (deze zijn afhankelijk van de golflengte) weinig invloed heeft op $\tau$. Ze heffen elkaar als het ware op. Anderzijds heeft de gebruikte vezel een zeer grote invloed op de waarde van $\tau$. De rede hiervoor is dat de tijdsconstante zeer sterk afhankelijk is van de straal van de optische vezel ($w_L$). Men kan zien dat voor de muli-mode vezel de tijdsconstanten veel groter zijn dan voor single-mode. De rede hiervoor is vrij eenvoudig intui\"tief te verklaren. Een SM vezel is smaller, waardoor alle energie zich in een klein en smal gebied bevindt. Hierdoor kan de temperatuur makkelijker en dus sneller stijgen, wat leidt tot een kleine $\tau$. Voor de MM vezel is dezelfde energie over een groter gebied verspreidt, waardoor de temperatuur trager zal stijgen. Dit geeft een grotere waarde voor de tijdsconstante. 
\begin{figure*}[!ht]
    \centering
    \includegraphics[width=\textwidth]{gfx/4dT.png}
    \caption{Temperatuurstijging voor de 4 protocols om $t=3\tau$.}
    \label{fig:4dT}
  \end{figure*}

% tabel met tau
\begin{table}
\centering
\caption{Bekomen tijdsconstanten $\tau$ voor elk protocol.}
\begin{tabular}{c||c|c}
& $\tau_{SM}$ [$10^{-2} ms$]& $\tau_{MM} [$ms$]$ \\ \hline
$474 nm$ & $2.517870\pm 0.000007$ & $12.414\pm 0.016$ \\
$560 nm$ & $2.517975\pm 0.000006$ & $12.415\pm 0.014$ \\
\end{tabular}
\label{tab:tau}
\end{table}

Tot slot kunnen we de kleurenplots voor de vier protocols met elkaar vergelijken. Afbeelding \ref{fig:4dT} geeft de temperatuurstijging weer voor de verschillende protocols, telkens op $3\tau$, wat de uiterste grens van de geldigheid van het model is. Men kan een aantal zaken opmerken. Ten eerste komt de vorm sterk overeen met die van de afbeeldingen voor de lichtverdeling. Dat komt omdat in een gebied met een hoge lichtverdeling de temperatuur sterk zal stijgen en in een gebied met een lage lichtverdeling, zal de temperatuur minder sterk stijgen. Ook is te zien dat de temperatuursverandering voor $560nm$ telkens groter en verder verspreid is dan voor $474nm$. Dit komt, zoals eerder al vermeld werd, door de hogere absorptie bij $560nm$. 

	
	\subsection{Temperatuurstijging bij gepulste stimulatie}
Met behulp van matlab werd de temperatuurstijging voor gepulste stimulatie berekend voor verschillende stimulatie protocols (zie tabel \ref{tab:Tmax}). Dit werd echter enkel gedaan voor multi-mode vezels. De rede hiervoor is dat voor single-mode vezels de limiet van geldigheid van het gebruikte model overschreden wordt. Omdat $\tau$ voor SM zo klein is (orde $10^{-2}ms$), is de pulslengte telkens veel langer dan $3\tau$, wat de grens was voor de geldigheid van het model. 

In figuur \ref{fig:pulsplot} staat de temperatuurstijging afgebeeld voor een multi-mode vezel bij gepulste stimulatie met een frequentie van $40Hz$, een pulslengte van $0.001s$ en een irradiantie van $46mW/mm^2$. Er werden hier geen fouten berekend. Men herkent duidelijk de kenmerkende vorm voor gepulste stimulatie (zie figuur \ref{fig:puls}). De pulslengte is hier echter zo kort ten opzichte van $\tau$ dat de stijgende exponenti\"ele functie vrijwel recht lijkt. Ook ziet men dat de temperatuur al satureert bij de tweede puls omdat de contributie van de eerste puls triviaal geworden is wanneer de derde puls start. Tot slot is te zien dat de temperatuurstijging voor $474nm$ lager is dan die voor $560nm$. De rede hiervoor is net zoals bij de continue stimulatie dat de absorptie hoger is bij $560nm.$
%figuur uitleggen
%figuur toevoegen  
\begin{figure*}[!ht]
    \centering
    \includegraphics[width=\textwidth]{gfx/pulsplot.png}
    \caption{Temperatuurstijging voor gepulste stimulatie met een frequentie van $40Hz$, een pulslengte van $0.001s$ en een irradiantie van $46mW/mm^2$ op $z=0$ en $r=0$ voor een MM vezel.}
    \label{fig:pulsplot}
  \end{figure*}  

In tabel \ref{tab:Tmax} vindt men de resultaten voor de maximale temperatuurstijging voor verschillende stimulatie protocols. Hierop werden geen fouten berekend. Uit deze tabel kan men de invloed van de irradiantie, pulslengte en frequentie op $\Delta T_{max}$ afleiden. Wanneer deze stijgen, zal de maximale temperatuur ook stijgen. Dit is evident aangezien er meer fotonen in het weefsel worden gebracht en er dus ook meer fotonen geabsorbeerd kunnen worden, zodat de temperatuur meer stijgt. Bij een hoger frequentie heeft het weefsel ook minder tijd om de temperatuur terug te laten zakken, waardoor de contributies van voorgaande pulsen groter zijn. 
Opnieuw is te zien dat de temperatuurstijging bij $560nm$ hoger is.
Men zien dat de gevonden maximale temperatuurstijgingen ruim onder de $0.5^{\circ}C$ blijven, wat als ondergrens wordt genomen voor mogelijke schade aan het weefsel. Binnen dit model kan dus besloten worden dat gepulste stimulatie met de gegeven protocols waarschijnlijk geen weefselschade zal opleveren. Het is echter wel mogelijk dat wanneer de fouten berekend zouden worden, de temperatuurstijging toch hoger blijkt dan $0.5^{\circ}C$. Belangrijk hierbij is op te merken dat het gebruikte model een lagere temperatuurstijging voorspelt dan er in werkelijkheid is (zie figuur \ref{fig:comparison}). De mogelijkheid bestaat dus dat met het model een temperatuurstijging berekend wordt die niet schadelijk is, maar dat de werkelijke temperatuurstijging hoger is en mogelijks wel schadelijke gevolgen heeft. 
	
\begin{table*}[]
\centering
\caption{Maximale temperatuurstijging bij gepulste stimulatie met een MM vezel voor verschillende protocols.}
\label{tab:Tmax}
\begin{tabular}{l|l|l||l|l}

\hline
Irradiantie [$mW/mm^2$] & Pulslengte [$ms$] & Frequentie [$Hz$] & \multicolumn{2}{c}{Maximale $\Delta T$}[$m^{\circ}C$] \\
& & & $\lambda = 474$nm & $\lambda = 560$nm\\ 
\hline
\hline
$70.5$ & $5$ & $5$ & $4.54$ & $9.44$ \\
& & $20$ & $4.62$ & $9.61$\\
& & $130$ & $9.81$ & $20.4$ \\
$380$ & $30$ & $5$ & $67.2$ &$140$ \\
& & $10$ & $67.2$ &$140$ \\
& & $20$ & $68.4$ &$142$\\
$46$ & $1$ & $40$ & $0.798$ & $1.66$ \\
$10$ & $4$ & $5$ & $0.535$  & $1.11$ \\
& & $10$ & $0.535$ & $1.11$\\
& & $45$ & $0.642$ & $1.34$ \\
$5$ & $20$ & $8$ & $0.777$ & $1.62$ \\
\hline
\hline                   
\end{tabular}
\end{table*}

\subsection{Foutenanalyse}
\label{subsec:fout}
Het is belangrijk om bij het berekenen van de temperatuurstijging rekening te houden met de fouten op de gebruikte parameters. Er moet dus een foutenanalyse gedaan worden om zo de fouten op $\Delta T$ te berekenen. De temperatuurstijging is afhankelijk van volgende parameters $\Delta T(\mu_a,\mu_s, g,\rho, c, k, w_L, \phi)$ met $\phi(\mu_a, \mu_s, g)$. Aangezien de fouten op de absorptieco\"effici\"ent $\mu_a$ en gereduceerde verstrooiingsco\"effici\"ent $\mu_s'$ zeer groot zijn (zie figuur \ref{fig:AbsEnScat}), worden de fouten op de andere parameters verwaarloosd. De fouten op $\mu_a$ en $\mu_s'$ kunnen uit deze grafiek afgelezen worden. Vervolgens kan door $g$ constant te nemen, de fout op $\mu_s'$ eenvouding omgezet worden in een fout op $\mu_s$, daar $\mu_s'=(1-g)\mu_s$. Omdat de lichtverdeling bepaald werd met een Monte-Carlo methode, kan de fout hierop niet berekend worden met behulp van de doorwerkingsregel. De doorwerkingsregel voor een grootheid $Z$, berekend uit N onafhankelijke grootheden $X_1,X_2,\ldots,X_N$ met $Z=f(X_1,X_2,\ldots,X_N)$ wordt gegeven door:
\footnotesize
\begin{equation}
(\Delta Z)^2 = \left(\frac {\partial f}{\partial X_1}\right)^2(\Delta X_1)^2 +\left(\frac {\partial f}{\partial X_2}\right)^2(\Delta X_2)^2+ \cdots
\end{equation}
\normalsize
De fout op de temperatuurstijging werd als volgt berekend: De twee parameters waarop fouten gekend zijn ($\mu_a$ en $\mu_s$), werden elk afzonderlijk gevarieerd binnen hun foutenmarges. Door telkens de temperatuurstijging te berekenen met $\mu_a \pm \sigma$ of $\mu_s \pm \sigma$ kon achterhaald worden wat de invloed was van elke parameter op de temperatuurstijging. Uit deze analyse bleek dat de absorptieco\"effici\"ent een zeer grote invloed had op $\Delta T$, namelijk een grotere absorptie zorgt voor een grotere temperatuurstijging en omgekeerd, een kleinere absorptie zorgt voor een kleinere temperatuurstijging. De verstrooiingsco\"effici\"ent bleek zeer weinig invloed te hebben op de grootte van de temperatuurstijging. Toch was te zien dat grotere verstrooiing zorgde voor een iets grotere temperatuurstijging en dat een kleinere verstrooiing een iets kleinere temperatuurstijging tot gevolg had. Dit kan men zien op figuur \ref{fig:foutMM} voor multi-mode en voor single-mode in de bijlage (figuur \ref{fig:foutSM}). 

%figuur 
\begin{figure*}[!ht]
    \centering
    \includegraphics[width=\textwidth]{gfx/dT_time_mu-a_mu-s_foutMM.png}
    \caption{De invloed van $\mu_a \pm \sigma$ en $\mu_s \pm \sigma$ op de temperatuurstijging voor MM.}
    \label{fig:foutMM}
  \end{figure*}  
Vervolgens werd $\Delta T$ opnieuw berekend, met $\mu_a + \sigma$ en $\mu_s + \sigma$ om als bovengrens van de fout op $\Delta T$ te gebruiken en met $\mu_a - \sigma$ en $\mu_s - \sigma$ om de ondergrens van de fout op $\Delta T$ te gebruiken. Dit staat afgebeeld in figuren \ref{fig:dT_tijd_SM} en \ref{fig:dT_tijd_MM}. De fout op de temperatuurstijging werd enkel berekend voor continue stimulatie. Aangezien gepulste stimulatie vaker gebruikt wordt, is het zeer interessant om ook hier de fouten op te berekenen. Dat werd hier echter niet gedaan. 

Er werd ook een iets wiskundige methode gebruikt om de fouten te berekenen. Hierbij werd de fout op de lichtverdeling berekend met bovenvermelde methode. De invloed van $\mu_a \pm \sigma$ en $\mu_s \pm \sigma$ op de lichtverdeling wordt afgebeeld op figuur \ref{fig:scat+abs_variatie} voor $560nm$ en MM. De figuren voor de andere protocols kan men vinden in de bijlage op figuur \ref{fig:FR_scat+abs_variatie}. 
%figuur
\begin{figure*}[!ht]
    \centering
    \includegraphics[width=\textwidth]{gfx/scat+abs_variatie.png}
    \caption{De invloed van $\mu_a \pm \sigma$ en $\mu_s \pm \sigma$ op de lichtverdeling voor $560nm$ en MM.}
    \label{fig:scat+abs_variatie}
  \end{figure*} 

Vervolgens werd de fout op de temperatuurstijging berekend door gebruik te maken van de doorwerkingsregel. De resultaten hiervan staan afgebeeld in figuur \ref{}. Zoals men kan zien is de fout exponentieel afhankelijk van de tijd. Hierdoor zal $\Delta T - \sigma$ na een bepaalde tijd onder $0$ gaan. Dit is niet fysisch en daarom wordt de eerste methode geprefereerd.  

De fout op $\tau$ kon met de doorwerkingsregel berekend worden: 
\begin{equation}
\Delta \tau = \sqrt{\left(\frac{8c\pi^2\rho w_L^4 z_0}{k(\pi^2 w_L^2+23.04 z_0^2)^2}\right)^2(\Delta z_0)^2}
\end{equation}
met de fout op $z_0$:
\begin{equation}
\begin{split}
\Delta z_0 = &\sqrt{\left(\frac{2}{(\mu_a+(1-g)\mu_s)^2}\right)^2(\Delta \mu_a)^2}\\
& \overline{+\left(\frac{2(1-g)}{(\mu_a +(1-g)\mu_s)^2}\right)^2(\Delta \mu_s)^2}
\end{split}
\end{equation}

Aangezien de absorptie en gereduceerde verstrooiing de enige parameters zijn waar een significante fout op is, kan de nauwkeurigheid van $\Delta T$ verhoogt worden door de nauwkeurigheid van deze parameters te verhogen. Hiervoor zijn verdere experimentele verbeteringen nodig. 